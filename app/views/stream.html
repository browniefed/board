<section id="activity" class="g688">
  <ol id="events">
    <!-- filled by mustache -->
  </ol>
</section>

<section id="activity-preview" class="g1204">
  <!-- preview of the top-most event -->
</section>

<!-- tweets-->
<script id="mus-event-tweet" type="text/x-mustache">
  {{#results}}
  <li class="event tweet">
    <p class="content">{{&text2}}</p>
  </li>
  {{/results}}
</script>


<div id="tweets">
</div>
<script src="http://scripts.embed.ly/jquery.embedly.min.js"></script>
<script>
  var fetchInitialActivity = function(){
    $.ajax({
      url: "/api/tweets",
      dataType: 'json',
      success: function(data){
        console.log(data)
        if (data.results){
          data.results.forEach(function(r){
            if (r.text) {
              r.text2 = twitterlib.expandLinks(r)
              r.text2 = twitterlib.ify.link(r.text2)
              //r.text2 = twitterlib.ify.at(r.text2)
              //r.text2 = twitterlib.ify.hash(r.text2)
            }
          })
        }
        var html = pie.mtoHtml("#mus-event-tweet", data);
        console.log(html)
        $("#events").html(html)
        // be careful with this, we are limited/month
        // we should re-issue the key, move the key to the development.json file.
        //$('#tweets').embedly({key: "2046ddd0c25a4da59c0ae73d3d5c4d11"});
      }
    });
  }

  $(document).ready(function(){
    try{Typekit.load({
      active: fetchInitialActivity
    });}catch(e){}
  })
</script>